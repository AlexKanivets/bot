# Реализация модуля юридических документов при первом запуске

## Что реализовано

### 1. Новая функциональность в `legal_docs/settings.py`
- `FIRST_LAUNCH_LEGAL_DOCS_ENABLED` - включение/отключение показа документов при первом запуске
- `ACCEPT_BUTTON_TEXT` - текст кнопки "Принять"
- `FIRST_LAUNCH_MESSAGE` - сообщение при первом запуске

### 2. Новые тексты в `legal_docs/texts.py`
- `FIRST_LAUNCH_LEGAL_MESSAGE` - основное сообщение при первом запуске
- `DOCUMENTS_ACCEPTED_MESSAGE` - сообщение после принятия документов
- `ACCEPT_DOCUMENTS_BUTTON` - текст кнопки принятия

### 3. Обновленный роутер в `legal_docs/router.py`
- Новый хук `start_menu_hook` для интеграции с главным меню
- Функция `_build_first_launch_buttons()` для создания кнопок первого запуска
- Обработчик `accept_legal_documents` для кнопки "Принять"
- Автоматическая регистрация хука `start_menu`

### 4. Обновленный `start.py`
- Модифицированная функция `show_start_menu` для обработки замены меню
- Логика проверки хука `start_menu` на предмет замены стандартного меню
- Интеграция с системой хуков для показа юридических документов

## Как это работает

### При первом запуске пользователя:
1. Модуль проверяет, есть ли у пользователя ключи или активен ли пробный период
2. Если это первый запуск, хук `start_menu` возвращает специальный объект с флагом `replace_menu: True`
3. Функция `show_start_menu` в `start.py` обнаруживает этот флаг и заменяет стандартное меню
4. Пользователь видит сообщение о необходимости прочитать и принять документы
5. Отображаются кнопки для каждого документа и кнопка "Принять"

### После принятия документов:
1. Пользователь нажимает кнопку "Принять"
2. Обработчик `accept_legal_documents` показывает сообщение об успешном принятии
3. Автоматически перезапускается команда `/start` для показа стандартного меню

## Настройки

### Включение/отключение функциональности:
```python
# В legal_docs/settings.py
FIRST_LAUNCH_LEGAL_DOCS_ENABLED = True  # Включить показ при первом запуске
LEGAL_DOCS_ENABLED = True               # Включить весь модуль
```

### Настройка отображения в разделе "О сервисе":
```python
DISPLAY_MODE = "direct"        # "direct" или "menu"
DIRECT_LAYOUT = "separate_rows"  # "separate_rows" или "same_row"
```

## Преимущества реализации

1. **Модульность**: Функциональность полностью отделена от основного кода бота
2. **Гибкость**: Можно легко включить/отключить любую часть функциональности
3. **Интеграция**: Использует существующую систему хуков бота
4. **Настраиваемость**: Все тексты и настройки вынесены в отдельные файлы
5. **Безопасность**: Проверка валидности URL документов
6. **UX**: Пользователь не может пропустить принятие документов при первом запуске

## Структура файлов

```
legal_docs/
├── __init__.py          # Экспорт модуля
├── settings.py          # Все настройки модуля
├── texts.py             # Тексты и сообщения
├── router.py            # Основная логика и обработчики
└── README.md            # Документация
```

## Интеграция

Модуль автоматически интегрируется при импорте:
```python
from legal_docs import router
dp.include_router(router)
```

Хуки регистрируются автоматически:
- `start_menu` - для показа документов при первом запуске
- `about_vpn` - для добавления кнопок в раздел "О сервисе"